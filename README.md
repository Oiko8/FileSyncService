# ΠΕΡΙΓΡΑΦΗ ΤΟΥ PROJECT 

Το παρόν project υλοποιεί ένα File Synchronization Service (FSS) σε C γλώσσα σε περιβάλλον UNIX, χρησιμοποιώντας κλήσεις συστήματος χαμηλού επιπέδου για τη διαχείριση αρχείων και το bash scripting και χρήση named pipes για επικοινωνία μεταξύ των διεργασιών. Το σύστημα διασφαλίζει την δημιουργία αντιγράφων από έναν φάκελο πηγή σε έναν φάκελο προορισμό, επιτρέπει στον χρήστη να παρέμβει ή να ενημερωθεί για τους συγχρονισμούς μέσω εντολών που δίνει στην κονσόλα και με χρήση των συναρτήσεων inotify παρακολουθεί τις εξελίξεις των υπό επεξεργασία φακέλων. 




# ΠΛΑΝΟ ΥΛΟΠΟΙΗΣΗΣ ΤΟΥ PROJECT

Κάνοντας τον αρχικό προγραμματισμό, το project βασίστηκε σε 4 βασικά προγράμματα:
1. fss_manager.c : η υλοποίηση ξεκίνησε από αυτό καθώς είναι ο πυρήνας του όλου συστήματος. Συνεργάζεται άμεσα με τα άλλα δύο βασικά προγράμματα που θα περιγραφούν παρακάτω, fss_console.c και worker_process.c. Έχει τρεις βασικές λειτουργίες, οι οποίες επιτυγχάνονται με την βοήθεια άλλων συμπληρωματικών λειτουργιών που θα αναλυθούν παρακάτω και οι οποίες είναι η εξής: 
	1. Διαβάζει το config_file, το οποίο θεωρούμε ότι αποτελείται από ζεύγη φακέλων σε κάθε γραμμή και το πρώτο αποτελεί την πηγή και το δεύτερο τον προορισμό. Ο manager καλείται να συγχρονίσει πλήρως τους δύο φακέλους και να τους εντάξει στην δομή που κρατάει για παρακολούθησει.
	2. Παρακολουθεί συνεχώς μέσω inotify τους φακέλους πηγές που έχουν προστεθεί στην δομή δεδομένων που κρατάει και για όποια αλλαγή παρατηρηθεί(CREATE, MODIFY, DELETE) στα αρχεία του φακέλου πηγή, φροντίζει να συγχρονίσει άμεσα τον φάκελο προορισμό.
	3. Δημιουργεί δύο FIFOs (named pipes) μέσω των οποίων επικοινωνεί με τον console, από τον οποίο δέχεται κάποιες εντολές (add, cancel, status, sync, shutdown) και για κάθε μία φροντίζει να εκτελέσει τις αντίστοιχες λειτουργίες, όπως θα περιγραφούν στον fss_console.c .


2. worker_process.c : η διεργασία αυτή εκτελείται από τον manager με τη χρήση κλήσεων συστήματος της οικογένειας exec() και της fork() και φροντίζει για τον συγχρονισμό των αρχείων. Δέχεται σαν ορίσματα το ζεύγος των φακέλων που καλείται να συγχρονίσει καθώς και τον τύπο του συγχρονισμού που πρέπει να εκτελέσει. Οι επιλογές είναι οι εξής:
	1. ADDED: προσθέτει απλά το αρχείο που δέχτηκε σαν όρισμα στον προορισμό(δεδομένο είναι ότι υπάρχει στην πηγή λόγω τελευταίων αλλαγών).
	2. MODIFIED: αντιγράφει εκ νέου το αρχείο που δέχτηκε σαν όρισμα στον προορισμό και κρατάει την νέα εκδοχή(δεδομένο ότι το αρχείο τροποποιήθηκε στην πηγή)
	3. DELETED: διαγράφει στον προορισμό το αρχείο που δέχτηκε σαν όρισμα το οποίο προηγουμένως διαγράφτηκε και στον φάκελο πηγή(ώστε να είναι συγχρονισμένοι και πάλι).
	4. FULL: αντιγράφει εκ νέου όλο το περιεχόμενο του φακέλου πηγή στον προορισμό(φροντίζει ο προορισμός να είναι άδειος ώστε εν τέλει να είναι πλήρως συγχρονισμένοι οι δύο φάκελοι.

[ σημείωση: είναι φανερό ότι όσον αφορά το config_file και τις εντολές από τον console(add,sync) ο worker καλείται να εκτελέσει FULL συγχρονισμό. Οι άλλες επιλογές(ADDED,MODIFIED,DELETED) αφορούν αλλαγές που εντοπίστηκαν σε μεμονομένα αρχεία των καταλόγων που παρακολουθούνται μέσω inotify ]


3. fss_console.c : ουσιαστικά αποτελεί μία διεπαφή με τον χρήστη ο οποίος μπόρει να δώσει εντολές μέσω αυτού, οι οποίες θα εκτελεστούν από τον manager. Ο console επικοινωνεί με τον manager χρησιμοποιώντας τα named pipes, στέλνει σε αυτόν τις εντολές που του υπαγορεύει ο χρήστης και δέχεται πίσω ένα ενημερωτικό μήνυμα για την ολοκλήρωση των απαραίτητων εργασιών ή αναλόγα για τα όποια προβλήματα παρουσιάστηκαν. Οι εντολές που επιτρέπονται στον χρήστη είναι οι εξής:
	1. add source target: με αυτήν την εντολή ο manager προσθέτει στην δομή με τους καταλόγους το ζεύγος source-target για παρακολούθηση και εκκινεί πλήρη συγχρονισμό μεταξύ των δύο.
	2. cancel source: με αυτήν την εντολή ο manager σταματάει την παρακολούθηση για τον κατάλογο source και τον διαγράφει από την δομή δεδομένων του (θεωρείται δεδομένο ότι κάθε source επιτρέπεται να έχει μοναδικό target και όχι πολλαπλά)
	3. status source: τυπώνεται ένα ενημερωτικό μήνυμα για την κατάσταση του καταλόγου source. Περιλαμβάνει ημερομηνία τελευταίου συγχρονισμού, πόσα λάθη έγιναν και αν ο φάκελος είναι ενεργός.
	4. sync source target: ο manager εκκινεί πλήρη συγχρονισμό μεταξύ των δύο φακέλων source-target άσχετα με το αν είναι πλήρως συγχρονισμένη ή όχι.
	5. shutdown: δεχόμενος αυτήν την εντολή ο manager φροντίζει να τελειώσει όλες τις εργασίες σε εκκρεμότητα και στην συνέχεια τερματίζει. Ομοίως τερματίζει και ο console.


4. fss_script.sh: πρόκειται για ένα bash script το οποίο δέχεται σαν παράμετρο ένα path (σε ένα logfile ή σε έναν κατάλογο) και μία εντολή. Οι εντολές που δέχεται είναι οι εξής:
	1. listAll : Αναζητά στο log-file (path) και εμφανίζει όλους τους καταλόγους, την ημερομηνία και ώρα τελευταίου συγχρονισμού, μαζί με status (Success, Error, Partial).
	2. purge : Διαγράφει το αρχείο/κατάλογο που βρίσκεται στο path, είτε το path αναφέρεται σε ένα logfile ή σε έναν κατάλογο.
 




# ΔΟΜΗ ΑΡΧΕΙΩΝ

Τα συνολικά αρχεία που χρησιμοποιήθηκαν στο project είναι τα εξής:
1. fss_manager.c
2. worker_process.c
3. fss_console.c
4. fss_script.sh
5. Makefile
6. queue_implementation.c
7. queue_implementation.h
8. sync_info_mem_store.c
9. sync_info_mem_store.h




# ΟΔΗΓΙΕΣ ΕΚΤΕΛΕΣΗΣ

1. Compilation:
	- make : δημιουργία αντικείμενων και εκτελέσιμων αρχείων.
	- make clean : διαγραφή των αντικείμενων και εκτελέσιμων αρχείων.

2. Εκτέλεση:
	- ο manager τρέχει με την εντολή : ./fss_manager -l <manager_log_file> -c <config_file> -n WORKER_LIMIT
	- ο console τρέχει με την εντολή : ./fss_console -l <console_log_file> 	
	- το bash script εκτελείται ως εξής: 
		α.  ./fss_script.sh -p <logfile> -c listAll : εκτυπώνει την τελευταία ενημέρωση από όλους τους καταλόγους που παρακολουθήθηκαν και γράφτηκαν στο <logfile>.
		β.  ./fss_script.sh -p <logfile> -c purge : διαγράφει το περιεχόμενο του <logfile>
		γ.  ./fss_script.sh -p <directory> -c purge : αδειάζει το <directory>. Χρησιμοποιείται για να αδειάζουν τα target directories μετά τους συγχρονισμό τους με τα source.
	
3. Σημαντική σημείωση: ο manager πρέπει να τρέξει πρώτος για να δημιουργήσει τα named pipes ώστε να τρέξει και ο console. Προτείνεται τα δύο αρχεία να τρέxουν ταυτόχρονα. Ο manager είναι λειτουργικός και χωρίς τον console καθώς κάνει συγχρονισμό των καταλόγων του config_file και ανοίγει τα named pipes ως NON_BLOCKING ώστε να λειτουργεί και χωρίς να ανοίξει το άλλο άκρο. Ο console φυσικά μπλοκάρει και περιμένει να ανοίξει και ο manager για να τεθεί σε λειτουργία. Για λόγους ευχρηστίας και αποφυγής προβλημάτων ο console ελέγχει πότε θα κλείσει ο manager, οπότε σε περίπτωση απρόσμενου τερματισμού του console θα σταλεί "shutdown" στο manager και θα τερματίσει ομαλά κλείνοντας τα απαραίτητα ανοιχτά κανάλια.



# ΠΑΡΑΤΗΡΗΣΕΙΣ 
- O worker_process.c στέλνει την exec_report του στην μορφή που θα τυπωθεί στο log_file του manager για λόγους ευχρηστίας και για να μην επιβαρυνθεί ο manager επιπλέον με την επεξεργασία του μηνύματος.
- O manager τυπώνει στην οθόνη την ενημέρωση που γράφει στο log_file και ως έξτρα για καθαρότητα των εκτυπώσεων από ποιον worker είναι η ενημέρωση και επίσης ενημερώνει σε περίπτωση που ανιχνεύθηκε inotify_event και το εκτυπώνει πριν λάβει δράση για αυτό.
- Οι κατάλογοι θεωρείται ότι περιέχουν μόνο αρχεία και όχι άλλους κατολόγους.
- Ένα directory μπορεί να εισαχθεί μόνο μία φορά σαν source δηλαδή μπορεί να έχει μόνο ένα target. Αν θέλουμε να κάνουμε συγχρονισμό ενός source με άλλο target πρέπει να το κάνουμε cancel και ξανά add με το νέο target.
- ένα source που είναι ενεργό και παρακολουθείται, μπορεί να χρησιμοποιηθεί ως target σε ένα άλλο ζεύγος που θα γίνει add. Τότε το inotify θα ενημερώσει για τις αλλαγές του αρχικού source και θα κάνει εκ νέου συγχρονισμούς. Π.χ. 
add source1 target1
add source2 source1
Μόλις γίνει ο δεύτερος συγχρονισμός, θα γίνουν αλλαγές στο source1 οι οποίες θα ανιχνευθούν από το inotify καθώς το source1 παρακολουθείται.   
- Ο console ενημερώνει τον χρήστη για οποιοδήποτε λάθος στις εντολές που δέχεται.
- Η εντολή sync απαιτεί και το source και το directory, για μεγαλύτερη ασφάλεια ότι ο χρηστής θα εκτελέσει τον συγχρονισμό που θέλει και για έξτρα δυνατότητα να συγχρονιστεί ένα source με διαφορετικό target από αυτό που έχει γίνει add. Παράδειγμα:
add /home/source1 /home/backup1  -> θα εκτελεστεί.
add /home/source1 /home/backup2  -> δε θα εκτελεστεί και ο χρήστης θα ενημερωθεί ότι ο κατάλογος ήδη παρακολουθείται.
sync /home/source1 /home/backup2 -> θα εκτελεστεί κανονικά, ώστε ο χρήστης να μπορεί να κάνει έξτρα συγχρονισμούς χειροκίνητα.

